#cloud-config
users:
  - name: azure
    ssh-import-id: None
    lock-passwd: true
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDlsX57sCjlGTnGv5UIH/dSPX1jVTToDajEzwz0WPAWQ+0PIxlDyQIdeERQA1smS9BnTNSMs+BCWFGtsT6mJyOtXA1sg+v1jjr2zxGi5RcXDvOug6tIxHaNGL9OzIgVqvxAwSmGsJyaTodUF94TKLuLbVT+giHrFXDvrTofXpGDefGfX7IQDM/1swYle7fM0RaYNhvzOeYiBThjXVa4Sh2Pa3ovR7og7Zo7ItJjIIOk6H37pZN3UbLQtQLeXY94FtaxySxeWkMG7FL2JE/RJ7RIlun7bYZ7DoLXR9yrokTHtat/P6LHpB2TQyB6BtGwdrxKjrjA41MGMnHVFzB6qN4V magnus
      - ssh-dss AAAAB3NzaC1kc3MAAAEBAMWMhmzanVpREfj+ERXYLUz7p7YTPKJVrkhPygZ55ZOZumXFqkdCg3NlrQl/Ctm+Yc/6raQ8X1bqnKqkl5vQUx6zJmp8zb5d/HfB3lwVOPUw+GYCMsWXX1amhyhU2oDWAl+vQJJpxDNteS5vQIL/7DsAEA6E0CmLyTtdf4m+vxT5qoaDZB5Azm4Yw6Whecgi0OLArKSVZThs24Y9oVHijn6lode+y5ZzytKgJmGJfdN/oqT+2sEmW+xy/f6tOjiWgX1cmuBav1RezYN4vFmogl5yQO2JK6guFAomMU55nZC9iZN4HUVa5v9o6XA185XVtsaPDTdb1ZDaFDW6osBIUpEAAAAVAL0R0VDilO0mgME1Ya/MNn+i3lhVAAABACEIcxidIMbeVM4EK5DLRvAj+FWdKnzz5blkug9490Sj1bUPPhkBUnwwkdAIPNp2XFTEdUbAWr9V7IZn0pJbaBrfZHQXPjuPC4RAiuJnSRVq3DGa9TUYYCBsSvYSR74WnoHHQcYuFRNOCLeYly9yujNI5ujvgJqFnPFUm1nwoCKxz0tBUDlepGn6qt4+k7tF2k00fRheFBU5eWhpRUc2177WiICg2S3lV78gZVf+OUGOdCYjX0+Gzu28kN94e2M3CT6dLhfR0EvwmeBpNHY3aET5Cnz84aoUb6ocxXVseBA+mwA/0tlmJphQdQLKbVOV9q76jSX+bmk/5k26djd65McAAAEAVjtTvHSjsgjODni5OVJwKXmfapLqKif3cLZG2UULGfILZrOnV+Q6eZrLNwaPh98CpV2iB/7pawV3f1CPCjY0BxOIE2T2CGqAieEaczWRceugsY/jwvaD1SS92CnhZtrHB+0cK+dvZX6VXgYXlUa5NSuO66TocvMqz8A3ZjVAHKlnAXtngn1bAMTS2Ycui/V/NpVsZmCfF9CH5qbthqWQ1ElZ7Qxlfw3EDwfjpnPo9Qt/00lyfKjwXo+SFn1ZXrxPqpTbIYhcVkoKdFCRz4YpV/iJhXgI9GxhbQkkXjsBLgKyRAUgoBvxo30zwNQowI020tXfvZTD1/F92Oi2bhA9JQ== dorn
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDORGIa/Gerh6veaGEEsyZ8SMsMazKIUykZiPSJnvekkdiNynC4n4fbCvTLTUowxGQQ6gGadckZmp9DPqz1kwGea6wghI5wI3iN9DLN8QL2gWXF0mZBcyfuVM9+kGX8NLRP+tfPsDrEtgYC+HIbXwIGwK6I7u+Ne9X1RqVxG06OyVJ+r8CgResHWSE9D++eVZoNGT10NhXSWfXa2u53+Cqxkj7iKPNhooE0AMbp6MOEVdUnXYQVBWeW81hke54d2eKOL7oeg/j//kvdr6jQN5NsyXM74qRzfka8r1bGMb+KL2v6HYJfVpxv9M5NYAKeze8ibpBvbg0t+b5n1cvV6ezX fussenegger
      - ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAueuabCW5XjVB8CQna9thh0qTJx4rVqbJVFVLIk7MZP40Xb64CNDnheGj7zeuavH7abn694YkuNcw6XSAAxK0AOLpuNmDRbC1kTyy13yeqRNqhttagWipRTuGVPAzFG+nOPdar+GXwGxYnsKccSUmdn/GcdUFR/A8PfZADrw5DALCPMGc8nnytd8dFatAvppZog03JmJbBXQtvTukyOoxejf+sHeAtUGqnWHWvhZcoQvUsBYsxgpE88e1ZsE8jCUQ3dO5I7qD68w5PVrViYdIYO334PtWQ14TJVHg0bzdgs4BNAunDy7KIUqmKxZYRtQvGWbIgDwj8T6JiWHVV7Yrew== utz
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC2FC3t6rlWQLBeMJOTk6FJ7rlIuSIJH3YXAbl6KooMS6MhPq54KLPzQJyLMqFuSr35QDkEp6DrfOI1q14NeeW60w8xy5l5ub5IBINggqQXaLRk7/pvahnTw4ICt5Ps+YRlUjCRKs/CQZEzA7SAE8pg7zwVmv8uRs7QYp7BoBd76gwxEz+uktAdR4pLY9DvHUUpyeb3+ol11uC77t284ADEq+N6g24ZyZcfCdn6eV9Znerkv+LDIiVP4fdWjJvKeHVSPEqThf+ugEZAx2lSvZz52YaOAOYBl4M2gQu/2xltXeqylgb47REndEDqT5E99255GKQpr8jQWWVx2ze3A1g9 haudum
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzj1GoG1Z+P7jMJJMM+D/AB2cwK9cODM1HpcWExrz+ZTuexIlbDpS1EEPxX+pp1pvUnG1qTLVglqEXdDWgTH/lsURQr7s44HfTyopMqadi1pRqpp80KfTSkhucwDXFfHHB7tFolxR6SWN6f9qsM9tWzHnLXFFLVtWm7sb8LOHjw5gJ1EAK1PfvlJmg0UobFtWAg5qapYMW001cBG/rAewjqXRc/n5UX4IiAKK62KXcTJsFm+hunVkPh/FNvxZ7ImlvowOharxPp0hFVO2TydgLuXHd1ZAmyv3SAhL21YGGQoHOZJeNwdt4Y5fHdcMhSFP2Ef2wH0+8ft8yveVowKB7 bogensberger
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFDJLG9eSRvT3FbmQYDdBJMnfjxN6vqGdtj2dqn8dbULpI3Djh78xmn0nGHTkN8oNCBaQd4xMcsKgexEWublmjpchzJy6WDmtzCrmZsR+901uwqg2oXD5vhO29TxoDIDzSjzvt45UwEtlXiJjehF7dI7ebp4GtugDP48nemRsiTQS4azHoY4YIfH5XpzdmJWAOfXkTPFzFhIKk+STcZVEXYZi1HMPgU6z3kxQIYwL/Gq66OBHbvxItmv6EQAWW9Hjtjgi6Ciz5lgi9xy644G2x3Cltl3ZOfP+OzpLHlVFkNWAHzhNjErWPYFcuALG4J+LvJ79ivtR61cKlIenVsgW3 michael
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCp2XuTbLpP5ALGtZUz8wTipj9bmixXPYq7V8H30yXF26iYqCjVWbrC9ePc10Tx+g9BvhRTpR5Bx5Jj1pn05QyPOzbAjlkfyEEvvgxErchOL4f4L9PDFFLjPNs+SoXNUglHS1iyJ7wuBpqV2ttOcPL6icvX3gNBsNkbc1tWnpiOZWWnuUfFwTSHfRjP0VINVs06b0VsxuEWvBtV92D50TdHOO9ywQzM0itf3GtpQEwxYznwOdbOQUzgohEIgMLSX7bsZA+6xPSK7BZC9ZVHLdhp3/pIl48aAR1uGAK2g/KfYEAPhTeuk+AimhglRYopQqtpprGRVvrmSoapnxlm/ymm0LfiKdJ+qiPMbXrXtmbBPWfi/x56JWWGuq/YL+SgUIYDHL/xPza1vS/dMFrE+XVk7bojWecNqfwaZRxNXvnnfH/hewXspvTrJz3PR66m8kKeLg5/gxjLSkS8PiArt9M7FLmEGvXDAbImF98AOaJGMl0F/lWgFQ1BdBynq5gsiK29RjMCCMzL6I1nYXZr+9yC1bOrpSaXa44l5IpifW57wF+9o3jLDRGkecFNgA8RdeACLqLcMq+IXN3GfPt33zC9noDH+E+6hHXPs4hk5RW5gxlDiChaao0avqFKZW7Jy3posvGqXWiE3Owh/+mE58dJkGKZ7V7qGNFo0zbyoUVzvQ== ruslan
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC3OhY2vNGxL4/rmuFoRETMuEPc4i64UczYH9jUIYa5Nn6ba8gjMl9v0SR68Xjf5pES3Gnw3CvKvMbfmKI/5/fNgEjCZ+LYnP9bHgLe2m9DY1zdH3DBT65ci1ZV84eGbiGT50XZBeLw1/6iQvB3GY3N7U6giFlokuhOK2t8OLgw9un19Hb7PjWQmdvoX+aDprW+ugtx3LBUeRiILDGZxFrg7EM/glKUJhd04v9mf8+BFsRh3MJJ8yK/oNadDhsA96sMDLVZuyRwaNn8d8gv6n2bOMXPT5RmkrzRVwX3imE6XaD+urlxJFh+Mr8AJ5Ue0emYJcdVpmOSc5fZt1Jjl8BB claus
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCshBqMWwldUNPtIabdrTD+YB2JDaS1yUcO4Zw+4C6uiR6/sgK5on24uMfkPMvQDJbW4F88pIQvAfoVqZCFxHe/8Tlye/QQnDI2NqNjXnT4n3nAtiABYEkPwB7CFhgxcxBNQ/4GJBzCuM2pSX+SCOExXeRcuJzTgLMkD5fmcD6K2PRwnOIIL/ME5hTjsnLjPzXbUWe4bnbXdZl5vK7aSgIujR4Tk9jBXQJgrmu/PyRifyWC9H/l1Eb+GOsNm1/h+PruxcC1Tjwog9Tead49bxSFb28GuVmWUpHhmdfXX8PRkpYKmDVWZ1wISdFkCKLqqsN/dfwv3jqxQFZXTv/S3WCt aslan
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC/3uraebCDDGzVcP1uxvOxGlEeDNjiGah4dFpVMlCTl4bFoxpS68BQal4ca5l2dKWNSX8l6f/fBun7EqlNQxjhyQ3jqnvKTSa1PGhS7zKOWtybHrc12unQRHKKYghoNnctBsE07j5WhJTjqZOcjbVVvchumrlqZXGRL67t6hGmQDfMzJ6hpod2AvSiF+xD9ptZUVLt1+cSQ4Osg5DaskZOaevwSWLH9YhPqNl7WcIba31IN/g4SjA87sqlTGcHO+UFhYN3oRMg2CDyGkWMPzr0GBE1ppfnuvAcvqiYMuJPBUr8A5GhsmKCkbAdpY6pZ2UjzZ4xD0BfLDN85W9jeO2uJ5YYbnrHpJtXIrlK0Hy6PUKBEFlLCqg2Q0yNINauMmptnNytnY945JbxlcmJFaaW88H8b/wDbeR7JebnsWtYgWPZ2MkkSjeXWgTyvCmF+VriP6BbgUntDJAPh6Wfm7pQBTUOdWkrRuFNTqusp5O+2MfEuNzP9QK7suv7R7GLn02r0E+FcNKKFK9HwMxHs83az1fLL4FWY4K0zxiRgcW5e4/gLBGE1lx/OUzIGw+Rx3slC824S4++47VzbqBNKjndQJrZwqgZU4N/ae7Ta2nd51Xup+bIhHNa6NPcK/aAPIDKQz3XD0T6+V0+onHCN5OWK9uDIrGdq/TcripQxxGWSQ== adrian
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDZ2jiAxWX7sqRnF1cmzIJamXGnOs2JD5M3X5iwC+Pum/R6wUVfFStfkUbMaTapRxH54YJn7uVPyW0POxgvpjwOKqhl8JVAB7P5L5VdSVjt5oLCkFmRs17ZcDW0PbjxqZL1BXtVfjl0Bl9+7CuUx+R2UHZEDIYgYi7b8IlV/uDKsZJYTpuF1M4Wfx8z3/wQwMqaSAWmNIx4o3PlAyztcpNfbWY3VU+kxCKzgpIUKcIaTU44soduSjsaeKcOFot7LjgIpX603+qm1hXdNOhdvYdSrvfeicIOH1MtJdeh4jOQGEcxas0YGxnqEuUOPHkVRKvzZpGFy6H4O4VADeLV7TWKRDIx8Qvj4GxVCHb1oYbUp3W4vtLeCggtauYy0K01ZfyTvpgWrUwHA0Os9GSWc6rI76p5bF2XFHd+40/zu6nL6y3hXJ04oPvl0UFiSDA94Wcwy+8aSEQG7RXYuJrnoFhLvIYC5QYn0yYAflvG4gl5g5NceraIrf/PY8hThdwwXJHWmpxVvKFb4fJMqHFR1sgYywYRcoOFHB0nrT1RgdyJSbGkpo1581ephh2CUwJxuB/gWGaqVtz8MUHA1ujLyFvW6YgEsm1nOj/AQBh4lHF7vtQUqXxzStWv306u3JbrkzN666avJtfUCwApfZ6BWtg9/sdKzjqiFMlf3acimnHfRQ== moser
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: sudo
    shell: /bin/bash

packages:
   - python3.5
   - openjdk-8-jdk 

runcmd:
  - sh -c 'echo "root:root" | sudo chpasswd'
  - mkdir -p /opt/bin
  - mkdir -p /mnt/data
  - echo -e "o\nn\np\n1\n\n\nw" | sudo fdisk /dev/sdc
  - echo -e "y" | sudo mkfs.ext4 /dev/sdc
  - mount /dev/sdc /mnt/data

   # Docker daemon
  - apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
  - sh -c 'echo "deb https://apt.dockerproject.org/repo ubuntu-wily main" > /etc/apt/sources.list.d/docker.list'
  - apt-get -y update
  - apt-get -y install linux-image-extra-$(uname -r)
  - apt-get -y install docker-engine
  - systemctl daemon-reload
  - systemctl restart docker  
 
   # Ruxit agent
  - wget -O /opt/bin/ruxit-Agent-Linux-1.87.198.sh https://akp88036.live.ruxit.com/installer/agent/unix/latest/3xEDwbMRpYzbTI5H
  - chmod +x /opt/bin/ruxit-Agent-Linux-1.87.198.sh
  - sh -c 'echo "[Unit]\nDescription=Ruxit agent\n\n[Service]\nExecStart=/opt/bin/ruxit-Agent-Linux-1.87.198.sh\n\n[Install]\nWantedBy=multi-user.target" > /lib/systemd/system/ruxit.service'
  - systemctl enable ruxit.service
  - systemctl start ruxit.service
  
  # Crate instance
  - sh -c 'echo "[Unit]\nDescription=Crate Node\n\n[Service]\nExecStart=/usr/bin/docker run -d -p 4200:4200 -p 4300:4300 --env=\"CRATE_HEAP_SIZE=14g\"  
      -v /mnt/data/:/data 
      --name $(hostname) 
      crate:latest 
      crate  
      -Des.cluster.name=crate-metrics 
      -Des.http.port=4200 
      -Des.transport.tcp.port=4300 
      -Des.transport.publish_host=$(hostname)   
      -Des.multicast.enabled=false  
      -Des.discovery.zen.minimum_master_nodes=2  
      -Des.discovery.type=srv  
      -Des.discovery.srv.query=_metrics._srv.fir.io 
      -Des.path.data=/data/data 
      -Des.path.logs=/data/logs 
   \n\n[Install]\nWantedBy=multi-user.target" > /lib/systemd/system/crate.service'
  - systemctl enable crate.service
  - systemctl start crate.service
